<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“åœ°é¼ éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hole {
            transition: all 0.3s ease;
        }

        .mole {
            animation: popup 0.3s ease;
        }

        @keyframes popup {
            0% {
                transform: translateY(100%);
            }

            100% {
                transform: translateY(0);
            }
        }

        .hit-effect {
            animation: hit 0.5s ease;
        }

        @keyframes hit {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center" id="gameBody">
    <!-- éŠæˆ²æ¨™é¡Œ -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-yellow-600 mb-4">ğŸ”¨ æ‰“åœ°é¼ éŠæˆ² ğŸ¹</h1>

        <!-- éŠæˆ²è³‡è¨Šé¢æ¿ -->
        <div class="flex gap-8 justify-center items-center bg-white/80 backdrop-blur-sm rounded-lg p-4 shadow-lg">
            <div class="text-center">
                <div class="text-sm text-gray-600">åˆ†æ•¸</div>
                <div id="score" class="text-2xl font-bold text-green-600">0</div>
            </div>
            <div class="text-center">
                <div class="text-sm text-gray-600">æ™‚é–“</div>
                <div id="timer" class="text-2xl font-bold text-red-600">60</div>
            </div>
            <div class="text-center">
                <div class="text-sm text-gray-600">æœ€é«˜åˆ†</div>
                <div id="highScore" class="text-2xl font-bold text-purple-600">0</div>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²æ§åˆ¶æŒ‰éˆ• -->
    <div class="mb-8 flex gap-4">
        <button id="startBtn"
            class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105">
            é–‹å§‹éŠæˆ²
        </button>
        <button id="stopBtn"
            class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105"
            disabled>
            çµæŸéŠæˆ²
        </button>
        <button id="settingsBtn"
            class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105">
            è¨­å®š
        </button>
    </div>

    <!-- éŠæˆ²å€åŸŸ -->
    <div id="gameBoard" class="grid gap-4 mb-8"></div>

    <!-- è¨­å®šé¢æ¿ -->
    <div id="settingsPanel" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
            <h2 class="text-2xl font-bold mb-4 text-center">éŠæˆ²è¨­å®š</h2>

            <div class="space-y-4">
                <!-- æ ¼å­æ•¸é‡ -->
                <div>
                    <label class="block text-sm font-medium mb-2">æ ¼å­æ•¸é‡ï¼ˆ3x3 åˆ° 4x4ï¼‰</label>
                    <select id="gridSize" class="w-full p-2 border rounded">
                        <option value="3">3x3 (9æ ¼)</option>
                        <option value="4" selected>4x4 (16æ ¼)</option>
                    </select>
                </div>

                <!-- åœ°é¼ åœç•™æ™‚é–“ -->
                <div>
                    <label class="block text-sm font-medium mb-2">åœ°é¼ åœç•™æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰</label>
                    <input type="range" id="moleStayTime" min="800" max="2500" value="1500" class="w-full">
                    <div class="text-sm text-gray-600 text-center" id="stayTimeDisplay">1500ms</div>
                </div>

                <!-- åœ°é¼ å‡ºç¾é–“éš” -->
                <div>
                    <label class="block text-sm font-medium mb-2">åœ°é¼ å‡ºç¾é–“éš”ï¼ˆæ¯«ç§’ï¼‰</label>
                    <input type="range" id="moleInterval" min="600" max="1500" value="1000" class="w-full">
                    <div class="text-sm text-gray-600 text-center" id="intervalDisplay">1000ms</div>
                </div>

                <!-- ä¸»é¡Œé¸æ“‡ -->
                <div>
                    <label class="block text-sm font-medium mb-2">èƒŒæ™¯ä¸»é¡Œ</label>
                    <select id="theme" class="w-full p-2 border rounded">
                        <option value="grass">è‰åœ° ğŸŒ±</option>
                        <option value="desert">æ²™æ¼  ğŸœï¸</option>
                        <option value="ocean">æµ·æ´‹ ğŸŒŠ</option>
                        <option value="space">å¤ªç©º ğŸŒŒ</option>
                    </select>
                </div>

                <!-- åœ°é¼ é¡å‹ -->
                <div>
                    <label class="block text-sm font-medium mb-2">åœ°é¼ é¡å‹</label>
                    <select id="moleType" class="w-full p-2 border rounded">
                        <option value="ğŸ¹">åœ°é¼  ğŸ¹</option>
                        <option value="ğŸ­">è€é¼  ğŸ­</option>
                        <option value="ğŸ°">å…”å­ ğŸ°</option>
                        <option value="ğŸ¸">é’è›™ ğŸ¸</option>
                        <option value="ğŸ‘½">å¤–æ˜Ÿäºº ğŸ‘½</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-4 mt-6">
                <button id="applySettings"
                    class="flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded">
                    å¥—ç”¨è¨­å®š
                </button>
                <button id="closeSettings"
                    class="flex-1 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded">
                    é—œé–‰
                </button>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²çµæŸé¢æ¿ -->
    <div id="gameOverPanel" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-sm w-full mx-4 shadow-xl text-center">
            <h2 class="text-3xl font-bold mb-4 text-red-600">éŠæˆ²çµæŸï¼</h2>
            <div class="text-6xl mb-4">ğŸ†</div>
            <div class="text-xl mb-2">æœ€çµ‚åˆ†æ•¸</div>
            <div id="finalScore" class="text-4xl font-bold text-green-600 mb-4">0</div>
            <div id="newRecord" class="hidden text-lg text-purple-600 mb-4">ğŸ‰ æ–°ç´€éŒ„ï¼ğŸ‰</div>
            <button id="playAgain" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg">
                å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        // éŠæˆ²è¨­å®š
        const CONFIG = {
            gridSize: 4,           // æ ¼å­å¤§å° (NxN)
            gameTime: 60,          // éŠæˆ²æ™‚é–“ï¼ˆç§’ï¼‰
            moleStayTime: 1500,    // åœ°é¼ åœç•™æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
            moleInterval: 1000,    // åœ°é¼ å‡ºç¾é–“éš”ï¼ˆæ¯«ç§’ï¼‰
            theme: 'grass',        // èƒŒæ™¯ä¸»é¡Œ
            moleType: 'ğŸ¹'         // åœ°é¼ é¡å‹
        };

        // ä¸»é¡Œè¨­å®š
        const THEMES = {
            grass: {
                body: 'bg-gradient-to-b from-green-400 to-green-600',
                hole: 'bg-green-800 border-green-900'
            },
            desert: {
                body: 'bg-gradient-to-b from-yellow-400 to-orange-600',
                hole: 'bg-yellow-800 border-yellow-900'
            },
            ocean: {
                body: 'bg-gradient-to-b from-blue-400 to-blue-600',
                hole: 'bg-blue-800 border-blue-900'
            },
            space: {
                body: 'bg-gradient-to-b from-purple-900 to-black',
                hole: 'bg-gray-800 border-gray-900'
            }
        };

        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            isPlaying: false,
            score: 0,
            timeLeft: CONFIG.gameTime,
            highScore: parseInt(localStorage.getItem('whackMoleHighScore') || '0'),
            activeMoles: new Set(),
            gameTimer: null,
            moleTimer: null
        };

        // DOM å…ƒç´ 
        const elements = {
            gameBoard: document.getElementById('gameBoard'),
            score: document.getElementById('score'),
            timer: document.getElementById('timer'),
            highScore: document.getElementById('highScore'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            gameOverPanel: document.getElementById('gameOverPanel'),
            finalScore: document.getElementById('finalScore'),
            newRecord: document.getElementById('newRecord'),
            playAgain: document.getElementById('playAgain'),
            gameBody: document.getElementById('gameBody')
        };

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            updateDisplay();
            createGameBoard();
            setupEventListeners();
            applyTheme();
        }

        // å‰µå»ºéŠæˆ²æ¿
        function createGameBoard() {
            const size = CONFIG.gridSize;
            elements.gameBoard.className = `grid gap-4 mb-8 grid-cols-${size}`;
            elements.gameBoard.innerHTML = '';

            for (let i = 0; i < size * size; i++) {
                const hole = document.createElement('div');
                hole.className = `hole w-20 h-20 rounded-full border-4 cursor-pointer relative overflow-hidden ${THEMES[CONFIG.theme].hole}`;
                hole.dataset.index = i;

                const mole = document.createElement('div');
                mole.className = 'mole absolute inset-0 flex items-center justify-center text-4xl hidden';
                mole.textContent = CONFIG.moleType;

                hole.appendChild(mole);
                elements.gameBoard.appendChild(hole);
            }
        }

        // è¨­å®šäº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            elements.startBtn.addEventListener('click', startGame);
            elements.stopBtn.addEventListener('click', stopGame);
            elements.settingsBtn.addEventListener('click', showSettings);
            elements.playAgain.addEventListener('click', startGame);

            // è¨­å®šé¢æ¿
            document.getElementById('applySettings').addEventListener('click', applySettings);
            document.getElementById('closeSettings').addEventListener('click', hideSettings);

            // è¨­å®šè¼¸å…¥ç›£è½
            document.getElementById('moleStayTime').addEventListener('input', updateStayTimeDisplay);
            document.getElementById('moleInterval').addEventListener('input', updateIntervalDisplay);

            // é»æ“Šåœ°é¼ 
            elements.gameBoard.addEventListener('click', hitMole);

            // é»æ“Šå¤–éƒ¨é—œé–‰é¢æ¿
            elements.settingsPanel.addEventListener('click', (e) => {
                if (e.target === elements.settingsPanel) hideSettings();
            });
            elements.gameOverPanel.addEventListener('click', (e) => {
                if (e.target === elements.gameOverPanel) hideGameOver();
            });
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.timeLeft = CONFIG.gameTime;
            gameState.activeMoles.clear();

            elements.startBtn.disabled = true;
            elements.stopBtn.disabled = false;
            elements.settingsBtn.disabled = true;

            hideGameOver();
            updateDisplay();
            startTimer();
            startMoleSpawning();
        }

        // çµæŸéŠæˆ²
        function stopGame() {
            gameState.isPlaying = false;

            elements.startBtn.disabled = false;
            elements.stopBtn.disabled = true;
            elements.settingsBtn.disabled = false;

            clearInterval(gameState.gameTimer);
            clearTimeout(gameState.moleTimer);

            hideAllMoles();
            showGameOver();
        }

        // é–‹å§‹è¨ˆæ™‚å™¨
        function startTimer() {
            gameState.gameTimer = setInterval(() => {
                gameState.timeLeft--;
                updateDisplay();

                if (gameState.timeLeft <= 0) {
                    stopGame();
                }
            }, 1000);
        }

        // é–‹å§‹ç”Ÿæˆåœ°é¼ 
        function startMoleSpawning() {
            if (!gameState.isPlaying) return;

            spawnMole();

            gameState.moleTimer = setTimeout(() => {
                startMoleSpawning();
            }, CONFIG.moleInterval);
        }

        // ç”Ÿæˆåœ°é¼ 
        function spawnMole() {
            const holes = elements.gameBoard.children;
            const availableHoles = [];

            for (let i = 0; i < holes.length; i++) {
                if (!gameState.activeMoles.has(i)) {
                    availableHoles.push(i);
                }
            }

            if (availableHoles.length === 0) return;

            const randomIndex = availableHoles[Math.floor(Math.random() * availableHoles.length)];
            const hole = holes[randomIndex];
            const mole = hole.querySelector('.mole');

            gameState.activeMoles.add(randomIndex);
            mole.classList.remove('hidden');

            setTimeout(() => {
                if (gameState.activeMoles.has(randomIndex)) {
                    mole.classList.add('hidden');
                    gameState.activeMoles.delete(randomIndex);
                }
            }, CONFIG.moleStayTime);
        }

        // é»æ“Šåœ°é¼ 
        function hitMole(e) {
            if (!gameState.isPlaying) return;

            const hole = e.target.closest('.hole');
            if (!hole) return;

            const index = parseInt(hole.dataset.index);
            const mole = hole.querySelector('.mole');

            if (gameState.activeMoles.has(index) && !mole.classList.contains('hidden')) {
                gameState.score++;
                gameState.activeMoles.delete(index);
                mole.classList.add('hidden');

                // æ·»åŠ é»æ“Šæ•ˆæœ
                hole.classList.add('hit-effect');
                setTimeout(() => hole.classList.remove('hit-effect'), 500);

                updateDisplay();
            }
        }

        // éš±è—æ‰€æœ‰åœ°é¼ 
        function hideAllMoles() {
            const moles = elements.gameBoard.querySelectorAll('.mole');
            moles.forEach(mole => mole.classList.add('hidden'));
            gameState.activeMoles.clear();
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            elements.score.textContent = gameState.score;
            elements.timer.textContent = gameState.timeLeft;
            elements.highScore.textContent = gameState.highScore;
        }

        // é¡¯ç¤ºéŠæˆ²çµæŸ
        function showGameOver() {
            elements.finalScore.textContent = gameState.score;

            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('whackMoleHighScore', gameState.highScore.toString());
                elements.newRecord.classList.remove('hidden');
                updateDisplay();
            } else {
                elements.newRecord.classList.add('hidden');
            }

            elements.gameOverPanel.classList.remove('hidden');
        }

        // éš±è—éŠæˆ²çµæŸé¢æ¿
        function hideGameOver() {
            elements.gameOverPanel.classList.add('hidden');
        }

        // é¡¯ç¤ºè¨­å®š
        function showSettings() {
            if (gameState.isPlaying) return;

            // è¼‰å…¥ç•¶å‰è¨­å®š
            document.getElementById('gridSize').value = CONFIG.gridSize;
            document.getElementById('moleStayTime').value = CONFIG.moleStayTime;
            document.getElementById('moleInterval').value = CONFIG.moleInterval;
            document.getElementById('theme').value = CONFIG.theme;
            document.getElementById('moleType').value = CONFIG.moleType;

            updateStayTimeDisplay();
            updateIntervalDisplay();

            elements.settingsPanel.classList.remove('hidden');
        }

        // éš±è—è¨­å®š
        function hideSettings() {
            elements.settingsPanel.classList.add('hidden');
        }

        // å¥—ç”¨è¨­å®š
        function applySettings() {
            CONFIG.gridSize = parseInt(document.getElementById('gridSize').value);
            CONFIG.moleStayTime = parseInt(document.getElementById('moleStayTime').value);
            CONFIG.moleInterval = parseInt(document.getElementById('moleInterval').value);
            CONFIG.theme = document.getElementById('theme').value;
            CONFIG.moleType = document.getElementById('moleType').value;

            createGameBoard();
            applyTheme();
            hideSettings();
        }

        // å¥—ç”¨ä¸»é¡Œ
        function applyTheme() {
            const theme = THEMES[CONFIG.theme];
            elements.gameBody.className = `min-h-screen flex flex-col items-center justify-center ${theme.body}`;

            const holes = elements.gameBoard.querySelectorAll('.hole');
            holes.forEach(hole => {
                hole.className = `hole w-20 h-20 rounded-full border-4 cursor-pointer relative overflow-hidden ${theme.hole}`;
            });
        }

        // æ›´æ–°åœç•™æ™‚é–“é¡¯ç¤º
        function updateStayTimeDisplay() {
            const value = document.getElementById('moleStayTime').value;
            document.getElementById('stayTimeDisplay').textContent = `${value}ms`;
        }

        // æ›´æ–°é–“éš”æ™‚é–“é¡¯ç¤º
        function updateIntervalDisplay() {
            const value = document.getElementById('moleInterval').value;
            document.getElementById('intervalDisplay').textContent = `${value}ms`;
        }

        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
</body>

</html>