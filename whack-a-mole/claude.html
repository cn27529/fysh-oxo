<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>打地鼠遊戲</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hole {
            transition: all 0.3s ease;
        }

        .mole {
            animation: popup 0.3s ease;
        }

        @keyframes popup {
            0% {
                transform: translateY(100%);
            }

            100% {
                transform: translateY(0);
            }
        }

        .hit-effect {
            animation: hit 0.5s ease;
        }

        @keyframes hit {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center" id="gameBody">
    <!-- 遊戲標題 -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-yellow-600 mb-4">🔨 打地鼠遊戲 🐹</h1>

        <!-- 遊戲資訊面板 -->
        <div class="flex gap-8 justify-center items-center bg-white/80 backdrop-blur-sm rounded-lg p-4 shadow-lg">
            <div class="text-center">
                <div class="text-sm text-gray-600">分數</div>
                <div id="score" class="text-2xl font-bold text-green-600">0</div>
            </div>
            <div class="text-center">
                <div class="text-sm text-gray-600">時間</div>
                <div id="timer" class="text-2xl font-bold text-red-600">60</div>
            </div>
            <div class="text-center">
                <div class="text-sm text-gray-600">最高分</div>
                <div id="highScore" class="text-2xl font-bold text-purple-600">0</div>
            </div>
        </div>
    </div>

    <!-- 遊戲控制按鈕 -->
    <div class="mb-8 flex gap-4">
        <button id="startBtn"
            class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105">
            開始遊戲
        </button>
        <button id="stopBtn"
            class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105"
            disabled>
            結束遊戲
        </button>
        <button id="settingsBtn"
            class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105">
            設定
        </button>
    </div>

    <!-- 遊戲區域 -->
    <div id="gameBoard" class="grid gap-4 mb-8"></div>

    <!-- 設定面板 -->
    <div id="settingsPanel" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
            <h2 class="text-2xl font-bold mb-4 text-center">遊戲設定</h2>

            <div class="space-y-4">
                <!-- 格子數量 -->
                <div>
                    <label class="block text-sm font-medium mb-2">格子數量（3x3 到 4x4）</label>
                    <select id="gridSize" class="w-full p-2 border rounded">
                        <option value="3">3x3 (9格)</option>
                        <option value="4" selected>4x4 (16格)</option>
                    </select>
                </div>

                <!-- 地鼠停留時間 -->
                <div>
                    <label class="block text-sm font-medium mb-2">地鼠停留時間（毫秒）</label>
                    <input type="range" id="moleStayTime" min="800" max="2500" value="1500" class="w-full">
                    <div class="text-sm text-gray-600 text-center" id="stayTimeDisplay">1500ms</div>
                </div>

                <!-- 地鼠出現間隔 -->
                <div>
                    <label class="block text-sm font-medium mb-2">地鼠出現間隔（毫秒）</label>
                    <input type="range" id="moleInterval" min="600" max="1500" value="1000" class="w-full">
                    <div class="text-sm text-gray-600 text-center" id="intervalDisplay">1000ms</div>
                </div>

                <!-- 主題選擇 -->
                <div>
                    <label class="block text-sm font-medium mb-2">背景主題</label>
                    <select id="theme" class="w-full p-2 border rounded">
                        <option value="grass">草地 🌱</option>
                        <option value="desert">沙漠 🏜️</option>
                        <option value="ocean">海洋 🌊</option>
                        <option value="space">太空 🌌</option>
                    </select>
                </div>

                <!-- 地鼠類型 -->
                <div>
                    <label class="block text-sm font-medium mb-2">地鼠類型</label>
                    <select id="moleType" class="w-full p-2 border rounded">
                        <option value="🐹">地鼠 🐹</option>
                        <option value="🐭">老鼠 🐭</option>
                        <option value="🐰">兔子 🐰</option>
                        <option value="🐸">青蛙 🐸</option>
                        <option value="👽">外星人 👽</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-4 mt-6">
                <button id="applySettings"
                    class="flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded">
                    套用設定
                </button>
                <button id="closeSettings"
                    class="flex-1 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded">
                    關閉
                </button>
            </div>
        </div>
    </div>

    <!-- 遊戲結束面板 -->
    <div id="gameOverPanel" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-sm w-full mx-4 shadow-xl text-center">
            <h2 class="text-3xl font-bold mb-4 text-red-600">遊戲結束！</h2>
            <div class="text-6xl mb-4">🏆</div>
            <div class="text-xl mb-2">最終分數</div>
            <div id="finalScore" class="text-4xl font-bold text-green-600 mb-4">0</div>
            <div id="newRecord" class="hidden text-lg text-purple-600 mb-4">🎉 新紀錄！🎉</div>
            <button id="playAgain" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg">
                再玩一次
            </button>
        </div>
    </div>

    <script>
        // 遊戲設定
        const CONFIG = {
            gridSize: 4,           // 格子大小 (NxN)
            gameTime: 60,          // 遊戲時間（秒）
            moleStayTime: 1500,    // 地鼠停留時間（毫秒）
            moleInterval: 1000,    // 地鼠出現間隔（毫秒）
            theme: 'grass',        // 背景主題
            moleType: '🐹'         // 地鼠類型
        };

        // 主題設定
        const THEMES = {
            grass: {
                body: 'bg-gradient-to-b from-green-400 to-green-600',
                hole: 'bg-green-800 border-green-900'
            },
            desert: {
                body: 'bg-gradient-to-b from-yellow-400 to-orange-600',
                hole: 'bg-yellow-800 border-yellow-900'
            },
            ocean: {
                body: 'bg-gradient-to-b from-blue-400 to-blue-600',
                hole: 'bg-blue-800 border-blue-900'
            },
            space: {
                body: 'bg-gradient-to-b from-purple-900 to-black',
                hole: 'bg-gray-800 border-gray-900'
            }
        };

        // 遊戲狀態
        let gameState = {
            isPlaying: false,
            score: 0,
            timeLeft: CONFIG.gameTime,
            highScore: parseInt(localStorage.getItem('whackMoleHighScore') || '0'),
            activeMoles: new Set(),
            gameTimer: null,
            moleTimer: null
        };

        // DOM 元素
        const elements = {
            gameBoard: document.getElementById('gameBoard'),
            score: document.getElementById('score'),
            timer: document.getElementById('timer'),
            highScore: document.getElementById('highScore'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            gameOverPanel: document.getElementById('gameOverPanel'),
            finalScore: document.getElementById('finalScore'),
            newRecord: document.getElementById('newRecord'),
            playAgain: document.getElementById('playAgain'),
            gameBody: document.getElementById('gameBody')
        };

        // 初始化遊戲
        function initGame() {
            updateDisplay();
            createGameBoard();
            setupEventListeners();
            applyTheme();
        }

        // 創建遊戲板
        function createGameBoard() {
            const size = CONFIG.gridSize;
            elements.gameBoard.className = `grid gap-4 mb-8 grid-cols-${size}`;
            elements.gameBoard.innerHTML = '';

            for (let i = 0; i < size * size; i++) {
                const hole = document.createElement('div');
                hole.className = `hole w-20 h-20 rounded-full border-4 cursor-pointer relative overflow-hidden ${THEMES[CONFIG.theme].hole}`;
                hole.dataset.index = i;

                const mole = document.createElement('div');
                mole.className = 'mole absolute inset-0 flex items-center justify-center text-4xl hidden';
                mole.textContent = CONFIG.moleType;

                hole.appendChild(mole);
                elements.gameBoard.appendChild(hole);
            }
        }

        // 設定事件監聽器
        function setupEventListeners() {
            elements.startBtn.addEventListener('click', startGame);
            elements.stopBtn.addEventListener('click', stopGame);
            elements.settingsBtn.addEventListener('click', showSettings);
            elements.playAgain.addEventListener('click', startGame);

            // 設定面板
            document.getElementById('applySettings').addEventListener('click', applySettings);
            document.getElementById('closeSettings').addEventListener('click', hideSettings);

            // 設定輸入監聽
            document.getElementById('moleStayTime').addEventListener('input', updateStayTimeDisplay);
            document.getElementById('moleInterval').addEventListener('input', updateIntervalDisplay);

            // 點擊地鼠
            elements.gameBoard.addEventListener('click', hitMole);

            // 點擊外部關閉面板
            elements.settingsPanel.addEventListener('click', (e) => {
                if (e.target === elements.settingsPanel) hideSettings();
            });
            elements.gameOverPanel.addEventListener('click', (e) => {
                if (e.target === elements.gameOverPanel) hideGameOver();
            });
        }

        // 開始遊戲
        function startGame() {
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.timeLeft = CONFIG.gameTime;
            gameState.activeMoles.clear();

            elements.startBtn.disabled = true;
            elements.stopBtn.disabled = false;
            elements.settingsBtn.disabled = true;

            hideGameOver();
            updateDisplay();
            startTimer();
            startMoleSpawning();
        }

        // 結束遊戲
        function stopGame() {
            gameState.isPlaying = false;

            elements.startBtn.disabled = false;
            elements.stopBtn.disabled = true;
            elements.settingsBtn.disabled = false;

            clearInterval(gameState.gameTimer);
            clearTimeout(gameState.moleTimer);

            hideAllMoles();
            showGameOver();
        }

        // 開始計時器
        function startTimer() {
            gameState.gameTimer = setInterval(() => {
                gameState.timeLeft--;
                updateDisplay();

                if (gameState.timeLeft <= 0) {
                    stopGame();
                }
            }, 1000);
        }

        // 開始生成地鼠
        function startMoleSpawning() {
            if (!gameState.isPlaying) return;

            spawnMole();

            gameState.moleTimer = setTimeout(() => {
                startMoleSpawning();
            }, CONFIG.moleInterval);
        }

        // 生成地鼠
        function spawnMole() {
            const holes = elements.gameBoard.children;
            const availableHoles = [];

            for (let i = 0; i < holes.length; i++) {
                if (!gameState.activeMoles.has(i)) {
                    availableHoles.push(i);
                }
            }

            if (availableHoles.length === 0) return;

            const randomIndex = availableHoles[Math.floor(Math.random() * availableHoles.length)];
            const hole = holes[randomIndex];
            const mole = hole.querySelector('.mole');

            gameState.activeMoles.add(randomIndex);
            mole.classList.remove('hidden');

            setTimeout(() => {
                if (gameState.activeMoles.has(randomIndex)) {
                    mole.classList.add('hidden');
                    gameState.activeMoles.delete(randomIndex);
                }
            }, CONFIG.moleStayTime);
        }

        // 點擊地鼠
        function hitMole(e) {
            if (!gameState.isPlaying) return;

            const hole = e.target.closest('.hole');
            if (!hole) return;

            const index = parseInt(hole.dataset.index);
            const mole = hole.querySelector('.mole');

            if (gameState.activeMoles.has(index) && !mole.classList.contains('hidden')) {
                gameState.score++;
                gameState.activeMoles.delete(index);
                mole.classList.add('hidden');

                // 添加點擊效果
                hole.classList.add('hit-effect');
                setTimeout(() => hole.classList.remove('hit-effect'), 500);

                updateDisplay();
            }
        }

        // 隱藏所有地鼠
        function hideAllMoles() {
            const moles = elements.gameBoard.querySelectorAll('.mole');
            moles.forEach(mole => mole.classList.add('hidden'));
            gameState.activeMoles.clear();
        }

        // 更新顯示
        function updateDisplay() {
            elements.score.textContent = gameState.score;
            elements.timer.textContent = gameState.timeLeft;
            elements.highScore.textContent = gameState.highScore;
        }

        // 顯示遊戲結束
        function showGameOver() {
            elements.finalScore.textContent = gameState.score;

            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('whackMoleHighScore', gameState.highScore.toString());
                elements.newRecord.classList.remove('hidden');
                updateDisplay();
            } else {
                elements.newRecord.classList.add('hidden');
            }

            elements.gameOverPanel.classList.remove('hidden');
        }

        // 隱藏遊戲結束面板
        function hideGameOver() {
            elements.gameOverPanel.classList.add('hidden');
        }

        // 顯示設定
        function showSettings() {
            if (gameState.isPlaying) return;

            // 載入當前設定
            document.getElementById('gridSize').value = CONFIG.gridSize;
            document.getElementById('moleStayTime').value = CONFIG.moleStayTime;
            document.getElementById('moleInterval').value = CONFIG.moleInterval;
            document.getElementById('theme').value = CONFIG.theme;
            document.getElementById('moleType').value = CONFIG.moleType;

            updateStayTimeDisplay();
            updateIntervalDisplay();

            elements.settingsPanel.classList.remove('hidden');
        }

        // 隱藏設定
        function hideSettings() {
            elements.settingsPanel.classList.add('hidden');
        }

        // 套用設定
        function applySettings() {
            CONFIG.gridSize = parseInt(document.getElementById('gridSize').value);
            CONFIG.moleStayTime = parseInt(document.getElementById('moleStayTime').value);
            CONFIG.moleInterval = parseInt(document.getElementById('moleInterval').value);
            CONFIG.theme = document.getElementById('theme').value;
            CONFIG.moleType = document.getElementById('moleType').value;

            createGameBoard();
            applyTheme();
            hideSettings();
        }

        // 套用主題
        function applyTheme() {
            const theme = THEMES[CONFIG.theme];
            elements.gameBody.className = `min-h-screen flex flex-col items-center justify-center ${theme.body}`;

            const holes = elements.gameBoard.querySelectorAll('.hole');
            holes.forEach(hole => {
                hole.className = `hole w-20 h-20 rounded-full border-4 cursor-pointer relative overflow-hidden ${theme.hole}`;
            });
        }

        // 更新停留時間顯示
        function updateStayTimeDisplay() {
            const value = document.getElementById('moleStayTime').value;
            document.getElementById('stayTimeDisplay').textContent = `${value}ms`;
        }

        // 更新間隔時間顯示
        function updateIntervalDisplay() {
            const value = document.getElementById('moleInterval').value;
            document.getElementById('intervalDisplay').textContent = `${value}ms`;
        }

        // 初始化遊戲
        initGame();
    </script>
</body>

</html>